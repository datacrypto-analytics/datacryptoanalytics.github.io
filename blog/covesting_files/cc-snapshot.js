(function(a,b,c){'use strict';"undefined"!=typeof window&&"function"==typeof define&&define.amd?define(c):"undefined"!=typeof module&&module.exports?module.exports=c():b.exports?b.exports=c():b[a]=c()})("ccWebRecorder",this,function(){'use strict';/*! *****************************************************************************
    ccWebRecorder
    ***************************************************************************** */function a(a){var b="function"==typeof Symbol&&a[Symbol.iterator],c=0;return b?b.call(a):{next:function(){return a&&c>=a.length&&(a=void 0),{value:a&&a[c++],done:!a}}}}function b(a,b){var c="function"==typeof Symbol&&a[Symbol.iterator];if(!c)return a;var d,f,g=c.call(a),h=[];try{for(;(void 0===b||0<b--)&&!(d=g.next()).done;)h.push(d.value)}catch(a){f={error:a}}finally{try{d&&!d.done&&(c=g["return"])&&c.call(g)}finally{if(f)throw f.error}}return h}function c(){for(var a=[],c=0;c<arguments.length;c++)a=a.concat(b(arguments[c]));return a}function d(){return U++}function e(a){var b=a.toLowerCase().trim();return V.test(b)?"div":b}function f(a){try{var b=a.rules||a.cssRules;return b?Array.from(b).reduce(function(a,b){return a+g(b)},""):null}catch(a){return null}}function g(a){return h(a)?f(a.styleSheet)||"":a.cssText}function h(a){return"styleSheet"in a}function i(a){var b;return b=-1<a.indexOf("//")?a.split("/").slice(0,3).join("/"):a.split("/")[0],b=b.split("?")[0],b}function j(a){return a.replace(/^['\"]?|['\"]?$/g,"")}function k(a,b){return(a||"").replace(W,function(a,c,d,e){var f=c||d||e,g=j(f);if(!g)return a;if(!X.test(g))return"url('"+g+"')";if(Y.test(f))return"url("+f+")";if("/"===g[0])return"url('"+(i(b)+g)+"')";var h=b.split("/"),k=g.split("/");h.pop();for(var l,m=0,n=k;m<n.length;m++)if(l=n[m],"."===l)continue;else".."===l?h.pop():h.push(l);return"url('"+h.join("/")+"')"})}function l(a,b){if(""===b.trim())return b;var c=b.split(","),d=c.map(function(b){var c=b.trimLeft().trimRight(),d=c.split(" ");if(2===d.length){var e=m(a,d[0]);return e+" "+d[1]}if(1===d.length){var e=m(a,d[0]);return""+e}return""}).join(",");return d}function m(b,c){if(!c||""===c.trim())return c;var d=b.createElement("a");return d.href=c,d.href}function o(a){return"svg"===a.tagName||a instanceof SVGElement}function p(a,b,c){return"src"===b||"href"===b&&c?m(a,c):"srcset"===b&&c?l(a,c):"style"===b&&c?k(c,location.href):c}function q(a,b,c,d,g){switch(a.nodeType){case a.DOCUMENT_NODE:return{type:R.Document,childNodes:[]};case a.DOCUMENT_TYPE_NODE:return{type:R.DocumentType,name:a.name,publicId:a.publicId,systemId:a.systemId};case a.ELEMENT_NODE:var h=!1;"string"==typeof c?h=a.classList.contains(c):a.classList.forEach(function(a){c.test(a)&&(h=!0)});for(var i=e(a.tagName),j={},l=0,m=Array.from(a.attributes);l<m.length;l++){var n=m[l],q=n.name,r=n.value;j[q]=p(b,q,r)}if("link"===i&&d){var s=Array.from(b.styleSheets).find(function(b){return b.href===a.href}),t=f(s);t&&(delete j.rel,delete j.href,j._cssText=k(t,s.href))}if("style"===i&&a.sheet&&!(a.innerText||a.textContent||"").trim().length){var t=f(a.sheet);t&&(j._cssText=k(t,location.href))}if("input"===i||"textarea"===i||"select"===i){var r=a.value;"radio"!==j.type&&"checkbox"!==j.type&&r?j.value=g?"*".repeat(r.length):r:a.checked&&(j.checked=a.checked)}if("option"===i){var u=a.parentElement;j.value===u.value&&(j.selected=a.selected)}if("canvas"===i&&(j.rr_dataURL=a.toDataURL()),("audio"===i||"video"===i)&&(j.rr_mediaState=a.paused?"paused":"played"),h){var v=a.getBoundingClientRect(),w=v.width,x=v.height;j.rr_width=w+"px",j.rr_height=x+"px"}return{type:R.Element,tagName:i,attributes:j,childNodes:[],isSVG:o(a)||void 0,needBlock:h};case a.TEXT_NODE:var y=a.parentNode&&a.parentNode.tagName,z=a.textContent,A="STYLE"===y||void 0;return A&&z&&(z=k(z,location.href)),"SCRIPT"===y&&(z="SCRIPT_PLACEHOLDER"),{type:R.Text,textContent:z||"",isStyle:A};case a.CDATA_SECTION_NODE:return{type:R.CDATA,textContent:""};case a.COMMENT_NODE:return{type:R.Comment,textContent:a.textContent||""};default:return!1;}}function r(a,b,c,e,f,g,h){void 0===f&&(f=!1),void 0===g&&(g=!0),void 0===h&&(h=!1);var i=q(a,b,e,g,h);if(!i)return console.warn(a,"not serialized"),null;var j="__sn"in a?a.__sn.id:d();var k=Object.assign(i,{id:j});a.__sn=k,c[j]=a;var l=!f;if(k.type===R.Element&&(l=l&&!k.needBlock,delete k.needBlock),(k.type===R.Document||k.type===R.Element)&&l)for(var m=0,n=Array.from(a.childNodes);m<n.length;m++){var o=n[m],p=r(o,b,c,e,f,g,h);p&&k.childNodes.push(p)}return k}function s(a,b,c,d){void 0===b&&(b="rr-block"),void 0===c&&(c=!0),void 0===d&&(d=!1);var e={};return[r(a,a,e,b,!1,c,d),e]}function t(a,b,c){void 0===c&&(c=document);var d={capture:!0,passive:!0};return c.addEventListener(a,b,d),function(){return c.removeEventListener(a,b,d)}}function n(a,b,c){void 0===c&&(c={});var d=null,e=0;return function(){var f=Date.now();e||!1!==c.leading||(e=f);var g=b-(f-e),h=this,i=arguments;0>=g||g>b?(d&&(window.clearTimeout(d),d=null),e=f,a.apply(h,i)):!d&&!1!==c.trailing&&(d=window.setTimeout(function(){e=!1===c.leading?0:Date.now(),d=null,a.apply(h,i)},g))}}function u(a,b,c,d){var e=Object.getOwnPropertyDescriptor(a,b);return Object.defineProperty(a,b,d?c:{set:function(a){var b=this;setTimeout(function(){c.set.call(b,a)},0),e&&e.set&&e.set.call(this,a)}}),function(){return u(a,b,e||{},!0)}}function v(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight}function w(){return window.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth}function x(a,b){if(!a)return!1;if(a.nodeType===a.ELEMENT_NODE){var c=!1;return"string"==typeof b?c=a.classList.contains(b):a.classList.forEach(function(a){b.test(a)&&(c=!0)}),c||x(a.parentNode,b)}return x(a.parentNode,b)}function y(a){var b=Z.getId(a);return!Z.has(b)||!(a.parentNode&&a.parentNode.nodeType===a.DOCUMENT_NODE)&&(!a.parentNode||y(a.parentNode))}function z(a){return!!a.changedTouches}function A(){"NodeList"in window&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach)}function B(a,b){a.delete(b),b.childNodes.forEach(function(b){return B(a,b)})}function C(a,b){var c=b.parentNode;if(!c)return!1;var d=Z.getId(c);return!!a.some(function(a){return a.id===d})||C(a,c)}function D(a,b){var c=b.parentNode;return!!c&&(!!a.has(c)||D(a,c))}function E(a){return"__sn"in a}function F(b,c,d,e){var f=new MutationObserver(function(f){var g,h,i,j,k=[],l=[],m=[],o=[],q=new Set,s=new Set,t=new Set,u={},v=function(a,b){if(!x(a,c)){if(E(a)){s.add(a);var d=null;b&&E(b)&&(d=b.__sn.id),d&&(u[da(a.__sn.id,d)]=!0)}else q.add(a),t.delete(a);a.childNodes.forEach(function(a){return v(a)})}};f.forEach(function(a){var b=a.type,d=a.target,e=a.oldValue,f=a.addedNodes,g=a.removedNodes,h=a.attributeName;switch(b){case"characterData":{var i=d.textContent;x(d,c)||i===e||k.push({value:i,node:d});break}case"attributes":{var i=d.getAttribute(h);if(x(d,c)||i===e)return;var j=l.find(function(b){return b.node===d});j||(j={node:d,attributes:{}},l.push(j)),j.attributes[h]=p(document,h,i);break}case"childList":{f.forEach(function(a){return v(a,d)}),g.forEach(function(a){var b=Z.getId(a),e=Z.getId(d);if(!x(a,c)){if(q.has(a))B(q,a),t.add(a);else if(q.has(d)&&-1===b);else if(y(d));else s.has(a)&&u[da(b,e)]?B(s,a):m.push({parentId:e,id:b});Z.removeNodeFromMap(a)}});break}default:}});var w=[],z=function(a){var b=Z.getId(a.parentNode);return-1===b?w.push(a):void o.push({parentId:b,previousId:a.previousSibling?Z.getId(a.previousSibling):a.previousSibling,nextId:a.nextSibling?Z.getId(a.nextSibling):a.nextSibling,node:r(a,document,Z.map,c,!0,d,e)})};try{for(var A,F=a(s),G=F.next();!G.done;G=F.next())A=G.value,z(A)}catch(a){g={error:a}}finally{try{G&&!G.done&&(h=F.return)&&h.call(F)}finally{if(g)throw g.error}}try{for(var A,H=a(q),I=H.next();!I.done;I=H.next())A=I.value,D(t,A)||C(m,A)?D(s,A)?z(A):t.add(A):z(A)}catch(a){i={error:a}}finally{try{I&&!I.done&&(j=H.return)&&j.call(H)}finally{if(i)throw i.error}}for(;w.length&&!w.every(function(a){return-1===Z.getId(a.parentNode)});)z(w.shift());var J={texts:k.map(function(a){return{id:Z.getId(a.node),value:a.value}}).filter(function(a){return Z.has(a.id)}),attributes:l.map(function(a){return{id:Z.getId(a.node),attributes:a.attributes}}).filter(function(a){return Z.has(a.id)}),removes:m,adds:o};(J.texts.length||J.attributes.length||J.removes.length||J.adds.length)&&b(J)});return f.observe(document,{attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),f}function G(a,b){var c,d=[],e=n(function(b){var e=Date.now()-c;a(d.map(function(a){return a.timeOffset-=e,a}),b?$.TouchMove:$.MouseMove),d=[],c=null},500),f=n(function(a){var b=a.target,f=z(a)?a.changedTouches[0]:a,g=f.clientX,h=f.clientY;c||(c=Date.now()),d.push({x:g,y:h,id:Z.getId(b),timeOffset:Date.now()-c}),e(z(a))},b,{trailing:!1}),g=[t("mousemove",f),t("touchmove",f)];return function(){g.forEach(function(a){return a()})}}function H(a,b){var c=[],d=function(c){return function(d){if(!x(d.target,b)){var e=Z.getId(d.target),f=z(d)?d.changedTouches[0]:d,g=f.clientX,h=f.clientY;a({type:_[c],id:e,x:g,y:h})}}};return Object.keys(_).filter(function(a){var b=Number.isNaN;return b(+a)&&!a.endsWith("_Departed")}).forEach(function(a){var b=a.toLowerCase(),e=d(a);c.push(t(b,e))}),function(){c.forEach(function(a){return a()})}}function I(a,b){var c=n(function(c){if(c.target&&!x(c.target,b)){var d=Z.getId(c.target);if(c.target===document){var e=document.scrollingElement||document.documentElement;a({id:d,x:e.scrollLeft,y:e.scrollTop})}else a({id:d,x:c.target.scrollLeft,y:c.target.scrollTop})}},100);return t("scroll",c)}function J(a){var b=n(function(){var b=v(),c=w();a({width:+c,height:+b})},200);return t("resize",b,window)}function K(a,b,d,e){function f(a){var c=a.target;if(c&&c.tagName&&!(0>ea.indexOf(c.tagName))&&!x(c,b)){var f=c.type;if(!("password"===f||c.classList.contains(d))){var h=c.value,i=!1,j=fa.includes(f)||"TEXTAREA"===c.tagName;"radio"===f||"checkbox"===f?i=c.checked:j&&e&&(h="*".repeat(h.length)),g(c,{text:h,isChecked:i});var k=c.name;"radio"===f&&k&&i&&document.querySelectorAll("input[type=\"radio\"][name=\""+k+"\"]").forEach(function(a){a!==c&&g(a,{text:a.value,isChecked:!i})})}}}function g(b,c){var d=ga.get(b);if(!d||d.text!==c.text||d.isChecked!==c.isChecked){ga.set(b,c);var e=Z.getId(b);a(S(S({},c),{id:e}))}}var h=["input","change"].map(function(a){return t(a,f)}),i=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value"),j=[[HTMLInputElement.prototype,"value"],[HTMLInputElement.prototype,"checked"],[HTMLSelectElement.prototype,"value"],[HTMLTextAreaElement.prototype,"value"]];return i&&i.set&&h.push.apply(h,c(j.map(function(a){return u(a[0],a[1],{set:function(){f({target:this})}})}))),function(){h.forEach(function(a){return a()})}}function L(a){var b=CSSStyleSheet.prototype.insertRule;CSSStyleSheet.prototype.insertRule=function(c,d){return a({id:Z.getId(this.ownerNode),adds:[{rule:c,index:d}]}),b.apply(this,arguments)};var c=CSSStyleSheet.prototype.deleteRule;return CSSStyleSheet.prototype.deleteRule=function(b){return a({id:Z.getId(this.ownerNode),removes:[{index:b}]}),c.apply(this,arguments)},function(){CSSStyleSheet.prototype.insertRule=b,CSSStyleSheet.prototype.deleteRule=c}}function M(a,b){var c=function(c){return function(d){var e=d.target;!e||x(e,b)||a({type:"play"===c?aa.Play:aa.Pause,id:Z.getId(e)})}},d=[t("play",c("play")),t("pause",c("pause"))];return function(){d.forEach(function(a){return a()})}}function N(a,b){var d=a.mutationCb,e=a.mousemoveCb,f=a.mouseInteractionCb,g=a.scrollCb,h=a.viewportResizeCb,i=a.inputCb,j=a.mediaInteractionCb,k=a.styleSheetRuleCb;a.mutationCb=function(){for(var a=[],e=0;e<arguments.length;e++)a[e]=arguments[e];b.mutation&&b.mutation.apply(b,c(a)),d.apply(void 0,c(a))},a.mousemoveCb=function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];b.mousemove&&b.mousemove.apply(b,c(a)),e.apply(void 0,c(a))},a.mouseInteractionCb=function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];b.mouseInteraction&&b.mouseInteraction.apply(b,c(a)),f.apply(void 0,c(a))},a.scrollCb=function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];b.scroll&&b.scroll.apply(b,c(a)),g.apply(void 0,c(a))},a.viewportResizeCb=function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];b.viewportResize&&b.viewportResize.apply(b,c(a)),h.apply(void 0,c(a))},a.inputCb=function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];b.input&&b.input.apply(b,c(a)),i.apply(void 0,c(a))},a.mediaInteractionCb=function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];b.mediaInteaction&&b.mediaInteaction.apply(b,c(a)),j.apply(void 0,c(a))},a.styleSheetRuleCb=function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];b.styleSheetRule&&b.styleSheetRule.apply(b,c(a)),k.apply(void 0,c(a))}}function O(a,b){void 0===b&&(b={}),N(a,b);var c=F(a.mutationCb,a.blockClass,a.inlineStylesheet,a.maskAllInputs),d=G(a.mousemoveCb,a.mousemoveWait),e=H(a.mouseInteractionCb,a.blockClass),f=I(a.scrollCb,a.blockClass),g=J(a.viewportResizeCb),h=K(a.inputCb,a.blockClass,a.ignoreClass,a.maskAllInputs),i=M(a.mediaInteractionCb,a.blockClass),j=L(a.styleSheetRuleCb);return function(){c.disconnect(),d(),e(),f(),g(),h(),i(),j()}}function P(a){return S(S({},a),{timestamp:Date.now()})}function Q(a){function c(a){void 0===a&&(a=!1),ca(P({type:T.Meta,data:{href:window.location.href,width:w(),height:v()}}),a);var c=b(s(document,e,l,n),2),d=c[0],f=c[1];return d?void(Z.map=f,ca(P({type:T.FullSnapshot,data:{node:d,initialOffset:{left:document.documentElement.scrollLeft,top:document.documentElement.scrollTop}}}))):console.warn("Failed to snapshot the document")}void 0===a&&(a={});var d=a.emit,f=a.checkoutEveryNms,g=a.checkoutEveryNth,h=a.blockClass,e=void 0===h?"rr-block":h,i=a.ignoreClass,j=void 0===i?"rr-ignore":i,k=a.inlineStylesheet,l=void 0===k||k,m=a.maskAllInputs,n=void 0!==m&&m,o=a.hooks,p=a.mousemoveWait,q=void 0===p?50:p;if(!d)throw new Error("emit function is required");A();var r,u=0;ca=function(a,b){if(d(a,b),a.type===T.FullSnapshot)r=a,u=0;else if(a.type===T.IncrementalSnapshot){u++;var e=g&&u>=g,h=f&&a.timestamp-r.timestamp>f;(e||h)&&c(!0)}};try{var x=[t("DOMContentLoaded",function(){ca(P({type:T.DomContentLoaded,data:{}}))})],y=function(){c(),x.push(O({mutationCb:function(a){return ca(P({type:T.IncrementalSnapshot,data:S({source:$.Mutation},a)}))},mousemoveCb:function(a,b){return ca(P({type:T.IncrementalSnapshot,data:{source:b,positions:a}}))},mouseInteractionCb:function(a){return ca(P({type:T.IncrementalSnapshot,data:S({source:$.MouseInteraction},a)}))},scrollCb:function(a){return ca(P({type:T.IncrementalSnapshot,data:S({source:$.Scroll},a)}))},viewportResizeCb:function(a){return ca(P({type:T.IncrementalSnapshot,data:S({source:$.ViewportResize},a)}))},inputCb:function(a){return ca(P({type:T.IncrementalSnapshot,data:S({source:$.Input},a)}))},mediaInteractionCb:function(a){return ca(P({type:T.IncrementalSnapshot,data:S({source:$.MediaInteraction},a)}))},styleSheetRuleCb:function(a){return ca(P({type:T.IncrementalSnapshot,data:S({source:$.StyleSheetRule},a)}))},blockClass:e,ignoreClass:j,maskAllInputs:n,inlineStylesheet:l,mousemoveWait:q},o))};return"interactive"===document.readyState||"complete"===document.readyState?y():x.push(t("load",function(){ca(P({type:T.Load,data:{}})),y()},window)),function(){x.forEach(function(a){return a()})}}catch(a){console.warn(a)}}var R,S=function(){return S=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a},S.apply(this,arguments)};(function(a){a[a.Document=0]="Document",a[a.DocumentType=1]="DocumentType",a[a.Element=2]="Element",a[a.Text=3]="Text",a[a.CDATA=4]="CDATA",a[a.Comment=5]="Comment"})(R||(R={}));var T,U=1,V=/[^a-z]/,W=/url\(([^\)]+)\)/gm,X=/^(?!www\.|(?:http|ftp)s?:\/\/|[A-Za-z]:\\|\/\/).*/,Y=/^['|"]?(data:)([\w\/\+\-]+);(charset=[\w-]+|base64|utf8).*,(.*)/i,Z={map:{},getId:function(a){return a.__sn?a.__sn.id:-1},getNode:function(a){return Z.map[a]||null},removeNodeFromMap:function(a){var b=a.__sn&&a.__sn.id;delete Z.map[b],a.childNodes&&a.childNodes.forEach(function(a){return Z.removeNodeFromMap(a)})},has:function(a){return Z.map.hasOwnProperty(a)}};(function(a){a[a.DomContentLoaded=0]="DomContentLoaded",a[a.Load=1]="Load",a[a.FullSnapshot=2]="FullSnapshot",a[a.IncrementalSnapshot=3]="IncrementalSnapshot",a[a.Meta=4]="Meta",a[a.Custom=5]="Custom"})(T||(T={}));var $;(function(a){a[a.Mutation=0]="Mutation",a[a.MouseMove=1]="MouseMove",a[a.MouseInteraction=2]="MouseInteraction",a[a.Scroll=3]="Scroll",a[a.ViewportResize=4]="ViewportResize",a[a.Input=5]="Input",a[a.TouchMove=6]="TouchMove",a[a.MediaInteraction=7]="MediaInteraction",a[a.StyleSheetRule=8]="StyleSheetRule"})($||($={}));var _;(function(a){a[a.MouseUp=0]="MouseUp",a[a.MouseDown=1]="MouseDown",a[a.Click=2]="Click",a[a.ContextMenu=3]="ContextMenu",a[a.DblClick=4]="DblClick",a[a.Focus=5]="Focus",a[a.Blur=6]="Blur",a[a.TouchStart=7]="TouchStart",a[a.TouchMove_Departed=8]="TouchMove_Departed",a[a.TouchEnd=9]="TouchEnd"})(_||(_={}));var aa;(function(a){a[a.Play=0]="Play",a[a.Pause=1]="Pause"})(aa||(aa={}));var ba;(function(a){a.Start="start",a.Pause="pause",a.Resume="resume",a.Resize="resize",a.Finish="finish",a.FullsnapshotRebuilded="fullsnapshot-rebuilded",a.LoadStylesheetStart="load-stylesheet-start",a.LoadStylesheetEnd="load-stylesheet-end",a.SkipStart="skip-start",a.SkipEnd="skip-end",a.MouseInteraction="mouse-interaction",a.EventCast="event-cast"})(ba||(ba={}));var ca,da=function(a,b){return a+"@"+b},ea=["INPUT","TEXTAREA","SELECT"],fa=["color","date","datetime-local","email","month","number","range","search","tel","text","time","url","week"],ga=new WeakMap;return Q.addCustomEvent=function(a,b){if(!ca)throw new Error("please add custom event after start recording");ca(P({type:T.Custom,data:{tag:a,payload:b}}))},Q});